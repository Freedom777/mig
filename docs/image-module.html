<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Module Documentation</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Source+Sans+3:wght@400;600;700&family=Source+Serif+4:opsz,wght@8..60,600&display=swap" rel="stylesheet">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- Mermaid -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-code: #1a1f26;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border-color: #30363d;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-purple: #a371f7;
            --accent-orange: #d29922;
            --accent-red: #f85149;
            --accent-cyan: #39c5cf;
            --sidebar-width: 280px;
            --header-height: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: calc(var(--header-height) + 24px);
        }

        body {
            font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 24px;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .header-logo {
            font-family: 'Source Serif 4', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo .icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .header-version {
            margin-left: auto;
            font-size: 0.875rem;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            padding: 4px 12px;
            border-radius: 20px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 24px 0;
            z-index: 50;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            padding: 0 24px;
            margin-bottom: 8px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav a {
            display: block;
            padding: 8px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9375rem;
            transition: all 0.15s ease;
            border-left: 2px solid transparent;
        }

        .sidebar-nav a:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
            border-left-color: var(--accent-blue);
        }

        .sidebar-nav a.active {
            color: var(--accent-blue);
            background: rgba(88, 166, 255, 0.1);
            border-left-color: var(--accent-blue);
        }

        .sidebar-nav .sub-item {
            padding-left: 40px;
            font-size: 0.875rem;
        }

        /* Main Content */
        .main {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
        }

        .content {
            max-width: 900px;
            padding: 48px;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Source Serif 4', Georgia, serif;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-top: 48px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h2 .section-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-top: 24px;
            color: var(--text-secondary);
        }

        p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .lead {
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: 32px;
        }

        /* Code */
        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875em;
            background: var(--bg-code);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--accent-cyan);
        }

        pre {
            background: var(--bg-code) !important;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px !important;
            margin: 16px 0 24px !important;
            overflow-x: auto;
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.875rem;
            line-height: 1.7;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0 24px;
            font-size: 0.9375rem;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        td {
            color: var(--text-secondary);
        }

        td code {
            font-size: 0.8125rem;
        }

        tr:hover td {
            background: var(--bg-secondary);
        }

        /* Diagrams */
        .diagram-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            margin: 24px 0;
            overflow-x: auto;
        }

        .diagram-container .mermaid {
            display: flex;
            justify-content: center;
        }

        .diagram-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: border-color 0.15s ease;
        }

        .card:hover {
            border-color: var(--accent-blue);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .card-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .card-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-blue {
            background: rgba(88, 166, 255, 0.15);
            color: var(--accent-blue);
        }

        .badge-green {
            background: rgba(63, 185, 80, 0.15);
            color: var(--accent-green);
        }

        .badge-purple {
            background: rgba(163, 113, 247, 0.15);
            color: var(--accent-purple);
        }

        .badge-orange {
            background: rgba(210, 153, 34, 0.15);
            color: var(--accent-orange);
        }

        /* Callouts */
        .callout {
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }

        .callout-info {
            background: rgba(88, 166, 255, 0.1);
            border-color: var(--accent-blue);
        }

        .callout-warning {
            background: rgba(210, 153, 34, 0.1);
            border-color: var(--accent-orange);
        }

        .callout-success {
            background: rgba(63, 185, 80, 0.1);
            border-color: var(--accent-green);
        }

        .callout-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .callout p {
            margin: 0;
            font-size: 0.9375rem;
        }

        /* Method signatures */
        .method-signature {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }

        .method-name {
            color: var(--accent-blue);
        }

        .method-param {
            color: var(--accent-orange);
        }

        .method-type {
            color: var(--accent-purple);
        }

        .method-return {
            color: var(--accent-green);
        }

        /* File tree */
        .file-tree {
            background: var(--bg-code);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.8;
            margin: 16px 0 24px;
        }

        .file-tree .folder {
            color: var(--accent-blue);
        }

        .file-tree .file {
            color: var(--text-secondary);
        }

        .file-tree .file-new {
            color: var(--accent-green);
        }

        /* Lists */
        ul, ol {
            margin: 16px 0;
            padding-left: 24px;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 8px;
        }

        li::marker {
            color: var(--accent-blue);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-color);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main {
                margin-left: 0;
            }

            .content {
                padding: 32px 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-logo">
            <span class="icon">üì∑</span>
            Image Module
        </div>
        <span class="header-version">v1.0.0 ¬∑ Laravel 12</span>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">–ù–∞—á–∞–ª–æ</div>
            <ul class="sidebar-nav">
                <li><a href="#overview">–û–±–∑–æ—Ä</a></li>
                <li><a href="#installation">–£—Å—Ç–∞–Ω–æ–≤–∫–∞</a></li>
                <li><a href="#configuration">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</div>
            <ul class="sidebar-nav">
                <li><a href="#architecture">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è</a></li>
                <li><a href="#dependencies">–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</a></li>
                <li><a href="#flow">Flow –æ–±—Ä–∞–±–æ—Ç–∫–∏</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã</div>
            <ul class="sidebar-nav">
                <li><a href="#image-service">ImageService</a></li>
                <li><a href="#image-repository">ImageRepository</a></li>
                <li><a href="#queue-dispatcher">QueueDispatcher</a></li>
                <li><a href="#path-service">PathService</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</div>
            <ul class="sidebar-nav">
                <li><a href="#jobs">–î–∂–æ–±—ã</a></li>
                <li><a href="#model">–ú–æ–¥–µ–ª—å Image</a></li>
                <li><a href="#controller">–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</a></li>
                <li><a href="#command">–ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
            <ul class="sidebar-nav">
                <li><a href="#testing">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <div class="content">

            <!-- Overview -->
            <section id="overview">
                <h1>Image Module</h1>
                <p class="lead">
                    –ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è Laravel-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, 
                    –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—á–µ—Ä–µ–¥–µ–π, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ 
                    —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü.
                </p>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-icon" style="background: rgba(88, 166, 255, 0.15);">üì§</div>
                        <div class="card-title">–ó–∞–≥—Ä—É–∑–∫–∞</div>
                        <p class="card-desc">FTP-–∑–∞–≥—Ä—É–∑–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤ –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(163, 113, 247, 0.15);">üîç</div>
                        <div class="card-title">–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è</div>
                        <p class="card-desc">MD5 + Perceptual Hash –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –ø–æ—Ö–æ–∂–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(63, 185, 80, 0.15);">üñºÔ∏è</div>
                        <div class="card-title">Thumbnails</div>
                        <p class="card-desc">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä —á–µ—Ä–µ–∑ Intervention Image</p>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(210, 153, 34, 0.15);">üë§</div>
                        <div class="card-title">Face Recognition</div>
                        <p class="card-desc">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ª–∏—Ü —á–µ—Ä–µ–∑ Face API</p>
                    </div>
                </div>
            </section>

            <!-- Installation -->
            <section id="installation">
                <h2><span class="section-icon" style="background: rgba(63, 185, 80, 0.15);">‚ö°</span> –£—Å—Ç–∞–Ω–æ–≤–∫–∞</h2>

                <h3>1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã</h3>
                <p>–†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ <code>image-refactored.zip</code> –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é <code>app/</code></p>

                <div class="file-tree">
<span class="folder">app/</span>
‚îú‚îÄ‚îÄ <span class="folder">Contracts/</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file-new">ImagePathServiceInterface.php</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file-new">ImageQueueDispatcherInterface.php</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file-new">ImageRepositoryInterface.php</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file-new">ImageServiceInterface.php</span>
‚îú‚îÄ‚îÄ <span class="folder">Repositories/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file-new">ImageRepository.php</span>
‚îú‚îÄ‚îÄ <span class="folder">Services/</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file-new">ImagePathService.php</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file-new">ImageQueueDispatcher.php</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file-new">ImageService.php</span>
‚îú‚îÄ‚îÄ <span class="folder">Providers/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file-new">ImageServiceProvider.php</span>
‚îî‚îÄ‚îÄ <span class="folder">Models/</span>
    ‚îî‚îÄ‚îÄ <span class="file">Image.php</span> <span class="badge badge-orange">modified</span>
                </div>

                <h3>2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä</h3>
                <p>–î–æ–±–∞–≤–∏—Ç—å –≤ <code>bootstrap/providers.php</code>:</p>

                <pre><code class="language-php">&lt;?php

return [
    App\Providers\AppServiceProvider::class,
    App\Providers\ImageServiceProvider::class,  // ‚Üê –¥–æ–±–∞–≤–∏—Ç—å
];</code></pre>

                <h3>3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–Ω–¥–∏–Ω–≥–∏</h3>
                <pre><code class="language-bash">php artisan tinker

>>> app(App\Contracts\ImageServiceInterface::class)
=> App\Services\ImageService {#...}</code></pre>
            </section>

            <!-- Configuration -->
            <section id="configuration">
                <h2><span class="section-icon" style="background: rgba(210, 153, 34, 0.15);">‚öôÔ∏è</span> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>

                <p>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ <code>config/image.php</code>:</p>

                <pre><code class="language-php">&lt;?php

return [
    'paths' => [
        'disk' => env('IMAGE_DISK', 'private'),
        'images' => env('IMAGE_PATH', 'images'),
        'debug_subdir' => env('IMAGE_DEBUG_SUBDIR', 'debug'),
    ],

    'thumbnails' => [
        'width' => env('THUMBNAIL_WIDTH', 300),
        'height' => env('THUMBNAIL_HEIGHT', 200),
        'method' => env('THUMBNAIL_METHOD', 'cover'),
        'dir_format' => env('THUMBNAIL_DIR_FORMAT', '{width}x{height}'),
        'postfix' => env('THUMBNAIL_POSTFIX', '_{method}_{width}x{height}'),
    ],

    'processing' => [
        'phash_distance_threshold' => env('PHASH_DISTANCE_THRESHOLD', 5),
    ],

    'face_api' => [
        'url' => env('FACE_API_URL', 'http://127.0.0.1:5000'),
        'threshold' => env('FACE_RECOGNITION_THRESHOLD', 0.6),
    ],
];</code></pre>

                <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                <table>
                    <thead>
                        <tr>
                            <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                            <th>–¢–∏–ø</th>
                            <th>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>paths.disk</code></td>
                            <td>string</td>
                            <td>private</td>
                            <td>Storage disk –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</td>
                        </tr>
                        <tr>
                            <td><code>paths.images</code></td>
                            <td>string</td>
                            <td>images</td>
                            <td>–ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è</td>
                        </tr>
                        <tr>
                            <td><code>thumbnails.method</code></td>
                            <td>string</td>
                            <td>cover</td>
                            <td>cover, scale, resize, contain</td>
                        </tr>
                        <tr>
                            <td><code>processing.phash_distance_threshold</code></td>
                            <td>int</td>
                            <td>5</td>
                            <td>–ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ (–º–µ–Ω—å—à–µ = —Å—Ç—Ä–æ–∂–µ)</td>
                        </tr>
                        <tr>
                            <td><code>face_api.threshold</code></td>
                            <td>float</td>
                            <td>0.6</td>
                            <td>–ü–æ—Ä–æ–≥ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Architecture -->
            <section id="architecture">
                <h2><span class="section-icon" style="background: rgba(88, 166, 255, 0.15);">üèóÔ∏è</span> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è</h2>

                <p>–ú–æ–¥—É–ª—å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö SOLID —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ Dependency Injection:</p>

                <div class="diagram-container">
                    <div class="diagram-title">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</div>
                    <div class="mermaid">
graph TB
    subgraph Entry["Entry Points"]
        Controller["ApiImageActionController"]
        Command["ImagesProcess Command"]
    end

    subgraph Core["Core Services"]
        IS["ImageService"]
        IR["ImageRepository"]
        IQD["ImageQueueDispatcher"]
        IPS["ImagePathService"]
    end

    subgraph Jobs["Queue Jobs"]
        IPJ["ImageProcessJob"]
        TPJ["ThumbnailProcessJob"]
        MPJ["MetadataProcessJob"]
        GPJ["GeolocationProcessJob"]
        FPJ["FaceProcessJob"]
    end

    subgraph Data["Data Layer"]
        Model["Image Model"]
        DB[(Database)]
        Storage[(Storage)]
    end

    Controller --> IS
    Command --> IS
    IS --> IR
    IS --> IQD
    IQD --> IPS
    IQD --> IPJ
    IQD --> TPJ
    IQD --> MPJ
    IQD --> FPJ
    MPJ -.-> GPJ
    IR --> Model
    Model --> DB
    IPS --> Storage
    IPJ --> IR
    IPJ --> IPS

    style IS fill:#58a6ff,stroke:#58a6ff,color:#0d1117
    style IR fill:#a371f7,stroke:#a371f7,color:#0d1117
    style IQD fill:#3fb950,stroke:#3fb950,color:#0d1117
    style IPS fill:#d29922,stroke:#d29922,color:#0d1117
                    </div>
                </div>

                <div class="callout callout-info">
                    <div class="callout-title">üí° –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã</div>
                    <p>–í—Å–µ entry points –∏—Å–ø–æ–ª—å–∑—É—é—Ç <code>ImageService</code> –∫–∞–∫ –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞. 
                    –°–µ—Ä–≤–∏—Å –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ë–î) –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–µ–π (jobs).</p>
                </div>
            </section>

            <!-- Dependencies -->
            <section id="dependencies">
                <h2><span class="section-icon" style="background: rgba(163, 113, 247, 0.15);">üîó</span> –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</h2>

                <div class="diagram-container">
                    <div class="diagram-title">Dependency Injection</div>
                    <div class="mermaid">
graph LR
    subgraph Interfaces
        ISI["ImageServiceInterface"]
        IRI["ImageRepositoryInterface"]
        IQDI["ImageQueueDispatcherInterface"]
        IPSI["ImagePathServiceInterface"]
    end

    subgraph Implementations
        IS["ImageService"]
        IR["ImageRepository"]
        IQD["ImageQueueDispatcher"]
        IPS["ImagePathService"]
    end

    ISI --> IS
    IRI --> IR
    IQDI --> IQD
    IPSI --> IPS

    IS --> IRI
    IS --> IQDI
    IQD --> IPSI

    style ISI fill:#58a6ff,stroke:#58a6ff,color:#0d1117
    style IRI fill:#a371f7,stroke:#a371f7,color:#0d1117
    style IQDI fill:#3fb950,stroke:#3fb950,color:#0d1117
    style IPSI fill:#d29922,stroke:#d29922,color:#0d1117
                    </div>
                </div>

                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ</h3>
                <pre><code class="language-php">// ImageServiceProvider.php

public array $bindings = [
    ImagePathServiceInterface::class => ImagePathService::class,
    ImageRepositoryInterface::class => ImageRepository::class,
    ImageQueueDispatcherInterface::class => ImageQueueDispatcher::class,
    ImageServiceInterface::class => ImageService::class,
];</code></pre>
            </section>

            <!-- Flow -->
            <section id="flow">
                <h2><span class="section-icon" style="background: rgba(63, 185, 80, 0.15);">üîÑ</span> Flow –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>

                <div class="diagram-container">
                    <div class="diagram-title">–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    <div class="mermaid">
sequenceDiagram
    participant FTP
    participant Controller
    participant ImageService
    participant Repository
    participant Dispatcher
    participant Queue

    FTP->>Controller: POST /api/image/upload
    Controller->>ImageService: processNewUpload()
    ImageService->>Repository: exists()
    Repository-->>ImageService: false
    ImageService->>Repository: prepareImageData()
    ImageService->>Repository: updateOrCreate()
    Repository-->>ImageService: Image
    ImageService->>Dispatcher: dispatchAll()
    
    par Parallel Jobs
        Dispatcher->>Queue: ImageProcessJob
        Dispatcher->>Queue: ThumbnailProcessJob
        Dispatcher->>Queue: MetadataProcessJob
        Dispatcher->>Queue: FaceProcessJob
    end
    
    Dispatcher-->>ImageService: statuses
    ImageService-->>Controller: result
    Controller-->>FTP: JSON response
                    </div>
                </div>

                <h3>–¶–µ–ø–æ—á–∫–∞ Metadata ‚Üí Geolocation</h3>
                <div class="diagram-container">
                    <div class="mermaid">
flowchart LR
    A[MetadataProcessJob] --> B{GPS –¥–∞–Ω–Ω—ã–µ?}
    B -->|–î–∞| C[GeolocationProcessJob]
    B -->|–ù–µ—Ç| D[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ]
    C --> E[Nominatim API]
    E --> F[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞]
    F --> D

    style A fill:#a371f7,stroke:#a371f7,color:#0d1117
    style C fill:#3fb950,stroke:#3fb950,color:#0d1117
                    </div>
                </div>
            </section>

            <!-- ImageService -->
            <section id="image-service">
                <h2><span class="section-icon" style="background: rgba(88, 166, 255, 0.15);">üì¶</span> ImageService</h2>

                <p>–ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–µ–π.</p>

                <span class="badge badge-blue">App\Contracts\ImageServiceInterface</span>
                <span class="badge badge-purple">App\Services\ImageService</span>

                <h3>–ú–µ—Ç–æ–¥—ã</h3>

                <h4>processNewUpload()</h4>
                <div class="method-signature">
                    <span class="method-type">public function</span> 
                    <span class="method-name">processNewUpload</span>(
                    <span class="method-param">string $disk</span>,
                    <span class="method-param">string $path</span>,
                    <span class="method-param">string $filename</span>,
                    <span class="method-param">bool $skipIfExists = false</span>
                    ): <span class="method-return">array</span>
                </div>

                <p>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î –∏ —Å—Ç–∞–≤–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å –≤—Å–µ –¥–∂–æ–±—ã.</p>

                <table>
                    <thead>
                        <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–¢–∏–ø</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>$disk</code></td>
                            <td>string</td>
                            <td>Storage disk</td>
                        </tr>
                        <tr>
                            <td><code>$path</code></td>
                            <td>string</td>
                            <td>–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É</td>
                        </tr>
                        <tr>
                            <td><code>$filename</code></td>
                            <td>string</td>
                            <td>–ò–º—è —Ñ–∞–π–ª–∞</td>
                        </tr>
                        <tr>
                            <td><code>$skipIfExists</code></td>
                            <td>bool</td>
                            <td>–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:</strong></p>
                <pre><code class="language-php">[
    'success' => true,
    'image' => Image,
    'message' => 'Image uploaded and processing started',
    'queue_statuses' => [
        'image' => 'success',
        'thumbnail' => 'success',
        'metadata' => 'success',
        'face' => 'success',
    ]
]</code></pre>

                <h4>queueForProcessing()</h4>
                <div class="method-signature">
                    <span class="method-type">public function</span> 
                    <span class="method-name">queueForProcessing</span>(
                    <span class="method-param">Image $image</span>
                    ): <span class="method-return">array</span>
                </div>
                <p>–°—Ç–∞–≤–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫—É.</p>
            </section>

            <!-- ImageRepository -->
            <section id="image-repository">
                <h2><span class="section-icon" style="background: rgba(163, 113, 247, 0.15);">üóÑÔ∏è</span> ImageRepository</h2>

                <p>–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ –º–æ–¥–µ–ª—å—é Image –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.</p>

                <span class="badge badge-blue">App\Contracts\ImageRepositoryInterface</span>
                <span class="badge badge-purple">App\Repositories\ImageRepository</span>

                <h3>–ú–µ—Ç–æ–¥—ã</h3>

                <table>
                    <thead>
                        <tr><th>–ú–µ—Ç–æ–¥</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>prepareImageData(disk, path, filename)</code></td>
                            <td>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏</td>
                        </tr>
                        <tr>
                            <td><code>exists(disk, path, filename)</code></td>
                            <td>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ë–î</td>
                        </tr>
                        <tr>
                            <td><code>updateOrCreate(array $data)</code></td>
                            <td>–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</td>
                        </tr>
                        <tr>
                            <td><code>find(int $id)</code></td>
                            <td>–ù–∞–π—Ç–∏ –ø–æ ID</td>
                        </tr>
                        <tr>
                            <td><code>findOrFail(int $id)</code></td>
                            <td>–ù–∞–π—Ç–∏ –∏–ª–∏ –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ</td>
                        </tr>
                        <tr>
                            <td><code>findSimilarByPhash(hexHash, maxDistance)</code></td>
                            <td>–ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–µ–µ –ø–æ perceptual hash</td>
                        </tr>
                    </tbody>
                </table>

                <h3>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
                <pre><code class="language-php">$repository = app(ImageRepositoryInterface::class);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
if (!$repository->exists('private', 'images', 'photo.jpg')) {
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    $data = $repository->prepareImageData('private', 'images', 'photo.jpg');
    
    // –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
    $image = $repository->updateOrCreate($data);
}</code></pre>
            </section>

            <!-- QueueDispatcher -->
            <section id="queue-dispatcher">
                <h2><span class="section-icon" style="background: rgba(63, 185, 80, 0.15);">üì§</span> ImageQueueDispatcher</h2>

                <p>–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –¥–∂–æ–±–æ–≤ –≤ –æ—á–µ—Ä–µ–¥—å.</p>

                <span class="badge badge-blue">App\Contracts\ImageQueueDispatcherInterface</span>
                <span class="badge badge-green">App\Services\ImageQueueDispatcher</span>

                <h3>–ú–µ—Ç–æ–¥—ã</h3>

                <table>
                    <thead>
                        <tr><th>–ú–µ—Ç–æ–¥</th><th>–û—á–µ—Ä–µ–¥—å</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>dispatchAll(image, preparedData)</code></td>
                            <td>all</td>
                            <td>–í—Å–µ –¥–∂–æ–±—ã —Å—Ä–∞–∑—É</td>
                        </tr>
                        <tr>
                            <td><code>dispatchImageProcess(image)</code></td>
                            <td>images</td>
                            <td>–†–∞–∑–º–µ—Ä—ã –∏ —Ö–µ—à–∏</td>
                        </tr>
                        <tr>
                            <td><code>dispatchThumbnail(image, data)</code></td>
                            <td>thumbnails</td>
                            <td>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä</td>
                        </tr>
                        <tr>
                            <td><code>dispatchMetadata(image, data)</code></td>
                            <td>metadatas</td>
                            <td>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ EXIF</td>
                        </tr>
                        <tr>
                            <td><code>dispatchFace(image)</code></td>
                            <td>faces</td>
                            <td>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü</td>
                        </tr>
                    </tbody>
                </table>

                <h3>–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Å—Ç–∞—Ç—É—Å—ã</h3>
                <ul>
                    <li><code>success</code> ‚Äî –¥–∂–æ–±–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å</li>
                    <li><code>exists</code> ‚Äî –¥–∂–æ–±–∞ —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)</li>
                    <li><code>error</code> ‚Äî –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏</li>
                </ul>
            </section>

            <!-- PathService -->
            <section id="path-service">
                <h2><span class="section-icon" style="background: rgba(210, 153, 34, 0.15);">üìÅ</span> ImagePathService</h2>

                <p>–†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏ —Ñ–∞–π–ª–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º—ë–Ω.</p>

                <span class="badge badge-blue">App\Contracts\ImagePathServiceInterface</span>
                <span class="badge badge-orange">App\Services\ImagePathService</span>

                <h3>–ú–µ—Ç–æ–¥—ã</h3>

                <table>
                    <thead>
                        <tr><th>–ú–µ—Ç–æ–¥</th><th>–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>getImagePathByObj(Image)</code></td>
                            <td>–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É</td>
                        </tr>
                        <tr>
                            <td><code>getImagePathByParams(disk, path, filename)</code></td>
                            <td>–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</td>
                        </tr>
                        <tr>
                            <td><code>getDebugImagePath(Image)</code></td>
                            <td>–ü—É—Ç—å –∫ debug-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é</td>
                        </tr>
                        <tr>
                            <td><code>getThumbnailSubdir(width, height)</code></td>
                            <td>–ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "300x200")</td>
                        </tr>
                        <tr>
                            <td><code>getThumbnailFilename(filename, method, w, h)</code></td>
                            <td>–ò–º—è —Ñ–∞–π–ª–∞ thumbnail</td>
                        </tr>
                        <tr>
                            <td><code>getDefaultThumbnailPath(Image)</code></td>
                            <td>–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ thumbnail –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</td>
                        </tr>
                        <tr>
                            <td><code>getThumbnailUrl(Image)</code></td>
                            <td>URL –¥–ª—è frontend</td>
                        </tr>
                        <tr>
                            <td><code>getImageUrl(Image)</code></td>
                            <td>URL –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –¥–ª—è frontend</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Jobs -->
            <section id="jobs">
                <h2><span class="section-icon" style="background: rgba(163, 113, 247, 0.15);">‚ö°</span> –î–∂–æ–±—ã</h2>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-icon" style="background: rgba(88, 166, 255, 0.15);">üñºÔ∏è</div>
                        <div class="card-title">ImageProcessJob</div>
                        <p class="card-desc">MD5, perceptual hash, —Ä–∞–∑–º–µ—Ä—ã, –ø–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤</p>
                        <span class="badge badge-blue">images</span>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(163, 113, 247, 0.15);">üìê</div>
                        <div class="card-title">ThumbnailProcessJob</div>
                        <p class="card-desc">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä —á–µ—Ä–µ–∑ Intervention Image</p>
                        <span class="badge badge-purple">thumbnails</span>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(63, 185, 80, 0.15);">üìã</div>
                        <div class="card-title">MetadataProcessJob</div>
                        <p class="card-desc">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ EXIF —á–µ—Ä–µ–∑ ExifTool</p>
                        <span class="badge badge-green">metadatas</span>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(210, 153, 34, 0.15);">üìç</div>
                        <div class="card-title">GeolocationProcessJob</div>
                        <p class="card-desc">–ì–µ–æ–∫–æ–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ Nominatim API</p>
                        <span class="badge badge-orange">geolocation</span>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: rgba(248, 81, 73, 0.15);">üë§</div>
                        <div class="card-title">FaceProcessJob</div>
                        <p class="card-desc">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü —á–µ—Ä–µ–∑ Face API</p>
                        <span class="badge badge-blue">faces</span>
                    </div>
                </div>

                <h3>Supervisor –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <table>
                    <thead>
                        <tr><th>–û—á–µ—Ä–µ–¥—å</th><th>Workers</th><th>Timeout</th><th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>images</td>
                            <td>4</td>
                            <td>120s</td>
                            <td>‚Äî</td>
                        </tr>
                        <tr>
                            <td>thumbnails</td>
                            <td>4</td>
                            <td>120s</td>
                            <td>‚Äî</td>
                        </tr>
                        <tr>
                            <td>metadatas</td>
                            <td>4</td>
                            <td>120s</td>
                            <td>‚Äî</td>
                        </tr>
                        <tr>
                            <td>geolocation</td>
                            <td>1</td>
                            <td>120s</td>
                            <td>‚ö†Ô∏è Rate limit 1 req/sec</td>
                        </tr>
                        <tr>
                            <td>faces</td>
                            <td>8</td>
                            <td>360s</td>
                            <td>CPU-intensive</td>
                        </tr>
                    </tbody>
                </table>

                <div class="callout callout-warning">
                    <div class="callout-title">‚ö†Ô∏è –í–∞–∂–Ω–æ: Geolocation</div>
                    <p>Nominatim API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 1 –∑–∞–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥—É. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>numprocs=1</code> –≤ Supervisor!</p>
                </div>
            </section>

            <!-- Model -->
            <section id="model">
                <h2><span class="section-icon" style="background: rgba(88, 166, 255, 0.15);">üóÉÔ∏è</span> –ú–æ–¥–µ–ª—å Image</h2>

                <p>Eloquent –º–æ–¥–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Å–µ—Ä–≤–∏—Å—ã.</p>

                <h3>–°—Ç–∞—Ç—É—Å—ã</h3>
                <table>
                    <thead>
                        <tr><th>–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>STATUS_PROCESS</code></td>
                            <td>process</td>
                            <td>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</td>
                        </tr>
                        <tr>
                            <td><code>STATUS_OK</code></td>
                            <td>ok</td>
                            <td>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ</td>
                        </tr>
                        <tr>
                            <td><code>STATUS_RECHECK</code></td>
                            <td>recheck</td>
                            <td>–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</td>
                        </tr>
                        <tr>
                            <td><code>STATUS_NOT_PHOTO</code></td>
                            <td>not_photo</td>
                            <td>–ù–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</td>
                        </tr>
                    </tbody>
                </table>

                <h3>–û—Ç–Ω–æ—à–µ–Ω–∏—è</h3>
                <pre><code class="language-php">// –†–æ–¥–∏—Ç–µ–ª—å (–¥—É–±–ª–∏–∫–∞—Ç)
$image->parent();        // belongsTo Image

// –î–æ—á–µ—Ä–Ω–∏–µ (–¥—É–±–ª–∏–∫–∞—Ç—ã —ç—Ç–æ–≥–æ)
$image->children();      // hasMany Image

// –õ–∏—Ü–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
$image->faces();         // hasMany Face

// –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
$image->geolocationPoint();    // belongsTo ImageGeolocationPoint
$image->geolocationAddress();  // hasOneThrough ImageGeolocationAddress</code></pre>

                <h3>Hash –∞—Ç—Ä–∏–±—É—Ç—ã</h3>
                <p>–ü–æ–ª—è <code>hash</code> –∏ <code>phash</code> –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è:</p>
                <ul>
                    <li>–ü—Ä–∏ –∑–∞–ø–∏—Å–∏: hex ‚Üí binary</li>
                    <li>–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏: binary ‚Üí hex</li>
                </ul>
            </section>

            <!-- Controller -->
            <section id="controller">
                <h2><span class="section-icon" style="background: rgba(63, 185, 80, 0.15);">üéÆ</span> –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</h2>

                <p><code>ApiImageActionController</code> ‚Äî REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.</p>

                <h3>Endpoints</h3>
                <table>
                    <thead>
                        <tr><th>Method</th><th>URI</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-green">POST</span></td>
                            <td><code>/api/image/upload</code></td>
                            <td>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">GET</span></td>
                            <td><code>/api/image/{id}</code></td>
                            <td>–ü–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">GET</span></td>
                            <td><code>/api/image/{id}/thumbnail</code></td>
                            <td>–ü–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">GET</span></td>
                            <td><code>/api/image/{id}/debug</code></td>
                            <td>Debug –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">GET</span></td>
                            <td><code>/api/image/{id}/nearby</code></td>
                            <td>–°–æ—Å–µ–¥–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-purple">PATCH</span></td>
                            <td><code>/api/image/{id}/status</code></td>
                            <td>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-purple">PATCH</span></td>
                            <td><code>/api/image/{id}/complete</code></td>
                            <td>–ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≥–æ—Ç–æ–≤–æ–µ</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">DELETE</span></td>
                            <td><code>/api/image/{id}</code></td>
                            <td>–£–¥–∞–ª–∏—Ç—å (soft)</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Command -->
            <section id="command">
                <h2><span class="section-icon" style="background: rgba(210, 153, 34, 0.15);">üíª</span> –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</h2>

                <p>–ö–æ–º–∞–Ω–¥–∞ <code>images:process</code> –¥–ª—è batch-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.</p>

                <h3>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</h3>
                <pre><code class="language-bash"># –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
php artisan images:process private images

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
php artisan images:process private images --skip-existing</code></pre>

                <h3>–ê—Ä–≥—É–º–µ–Ω—Ç—ã</h3>
                <table>
                    <thead>
                        <tr><th>–ê—Ä–≥—É–º–µ–Ω—Ç/–û–ø—Ü–∏—è</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>disk</code></td>
                            <td>Storage disk (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)</td>
                        </tr>
                        <tr>
                            <td><code>source</code></td>
                            <td>–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)</td>
                        </tr>
                        <tr>
                            <td><code>--skip-existing</code></td>
                            <td>–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ</td>
                        </tr>
                    </tbody>
                </table>

                <div class="callout callout-info">
                    <div class="callout-title">üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è</div>
                    <p>–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ <code>debug/</code> –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ <code>WIDTHxHEIGHT</code> (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>300x200/</code>)</p>
                </div>
            </section>

            <!-- Testing -->
            <section id="testing">
                <h2><span class="section-icon" style="background: rgba(63, 185, 80, 0.15);">üß™</span> –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>

                <p>–ë–ª–∞–≥–æ–¥–∞—Ä—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ª–µ–≥–∫–æ –º–æ–∫–∞—é—Ç—Å—è:</p>

                <pre><code class="language-php">use App\Contracts\ImageRepositoryInterface;
use App\Contracts\ImageQueueDispatcherInterface;
use App\Services\ImageService;
use Mockery;

public function test_process_new_upload_creates_image()
{
    // Arrange
    $mockRepo = Mockery::mock(ImageRepositoryInterface::class);
    $mockRepo->shouldReceive('exists')->andReturn(false);
    $mockRepo->shouldReceive('prepareImageData')->andReturn([
        'source_disk' => 'private',
        'source_path' => 'images',
        'source_filename' => 'test.jpg',
        'size' => 1024,
        'created_at_file' => now(),
        'updated_at_file' => now(),
    ]);
    $mockRepo->shouldReceive('updateOrCreate')
        ->andReturn(new Image(['id' => 1]));

    $mockDispatcher = Mockery::mock(ImageQueueDispatcherInterface::class);
    $mockDispatcher->shouldReceive('dispatchAll')
        ->once()
        ->andReturn([
            'image' => 'success',
            'thumbnail' => 'success',
            'metadata' => 'success',
            'face' => 'success',
        ]);

    $service = new ImageService($mockRepo, $mockDispatcher);

    // Act
    $result = $service->processNewUpload(
        'private', 'images', 'test.jpg'
    );

    // Assert
    $this->assertTrue($result['success']);
    $this->assertEquals(1, $result['image']->id);
}</code></pre>

                <h3>–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
                <ul>
                    <li><code>ImageService</code> ‚Äî –ª–æ–≥–∏–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏</li>
                    <li><code>ImageRepository</code> ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)</li>
                    <li><code>ImageQueueDispatcher</code> ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∂–æ–±–æ–≤</li>
                    <li><code>ImagePathService</code> ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π</li>
                </ul>
            </section>

            <!-- Troubleshooting -->
            <section id="troubleshooting">
                <h2><span class="section-icon" style="background: rgba(248, 81, 73, 0.15);">üîß</span> Troubleshooting</h2>

                <h3>–î–∂–æ–±–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è</h3>
                <pre><code class="language-bash"># –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å workers
sudo supervisorctl status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f storage/logs/supervisor-photo-*.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –≤ RabbitMQ
php artisan queue:work rabbitmq --queue=images --once</code></pre>

                <h3>–î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è</h3>
                <ul>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å <code>phash_distance_threshold</code> –≤ –∫–æ–Ω—Ñ–∏–≥–µ</li>
                    <li>–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª–µ <code>phash</code> –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</li>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å —Å <code>BIT_COUNT</code></li>
                </ul>

                <h3>Face API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç</h3>
                <pre><code class="language-bash"># –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status face-api

# Health check
curl http://127.0.0.1:5000/health

# –õ–æ–≥–∏
tail -f storage/logs/face-api-error.log</code></pre>

                <h3>Thumbnail –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è</h3>
                <ul>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (<code>775</code>)</li>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É Imagick: <code>php -m | grep imagick</code></li>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ <code>image.thumbnails.dir_format</code></li>
                </ul>
            </section>

        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#58a6ff',
                primaryTextColor: '#e6edf3',
                primaryBorderColor: '#30363d',
                lineColor: '#8b949e',
                secondaryColor: '#21262d',
                tertiaryColor: '#161b22',
                background: '#0d1117',
                mainBkg: '#161b22',
                nodeBorder: '#30363d',
                clusterBkg: '#21262d',
                titleColor: '#e6edf3',
                edgeLabelBackground: '#161b22'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            },
            sequence: {
                actorMargin: 50,
                mirrorActors: false
            }
        });

        // Active nav link
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.sidebar-nav a');

        function setActiveLink() {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', setActiveLink);
        setActiveLink();
    </script>
</body>
</html>
