# Artisan –∫–æ–º–∞–Ω–¥—ã

## –û–±–∑–æ—Ä

| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `images:process` | Batch-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `images:thumbnails` | –î–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnails |
| `images:metadatas` | –î–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è metadata |
| `images:geolocations` | –î–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è geolocation |
| `images:faces` | –î–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è faces |
| `images:faces:check` | –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∞ faces |
| `images:phashes` | –ü–µ—Ä–µ—Å—á—ë—Ç pHash (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) |
| `images:check` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ |
| `images:cleanup-unused` | –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö debug-—Ñ–∞–π–ª–æ–≤ |

---

## images:process

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

```bash
php artisan images:process {disk} {source} [--skip-existing]
```

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã

| –ê—Ä–≥—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `disk` | Storage disk (–Ω–∞–ø—Ä–∏–º–µ—Ä: `private`) |
| `source` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ |

### –û–ø—Ü–∏–∏

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `--skip-existing` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î |

### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
php artisan images:process private images

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ
php artisan images:process private images --skip-existing

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
php artisan images:process private images/2024/vacation
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
2. –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç `debug/` –∏ `WIDTHxHEIGHT/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ .jpg/.jpeg:
   - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
   - –°—Ç–∞–≤–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å –≤—Å–µ 4 –¥–∂–æ–±—ã

### –í—ã–≤–æ–¥

```
Queued: private//images/photo1.jpg (ID: 123)
Queued: private//images/photo2.jpg (ID: 124)
Skipped: private//images/photo3.jpg - Image already exists
Image processing completed
```

---

## images:thumbnails

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnails –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –Ω–∏—Ö.

```bash
php artisan images:thumbnails
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ù–∞—Ö–æ–¥–∏—Ç `Image` –≥–¥–µ `thumbnail_path IS NULL`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞–≤–∏—Ç `ThumbnailProcessJob` –≤ –æ—á–µ—Ä–µ–¥—å

### –í—ã–≤–æ–¥

```
Found 150 images without thumbnails.
Completed: 148 queued, 2 skipped, 0 errors.
```

---

## images:metadatas

–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ EXIF –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

```bash
php artisan images:metadatas
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ù–∞—Ö–æ–¥–∏—Ç `Image` –≥–¥–µ `metadata IS NULL`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞–≤–∏—Ç `MetadataProcessJob` –≤ –æ—á–µ—Ä–µ–¥—å

---

## images:geolocations

–ì–µ–æ–∫–æ–¥–∏–Ω–≥ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.

```bash
php artisan images:geolocations
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ù–∞—Ö–æ–¥–∏—Ç `Image` –≥–¥–µ:
   - `metadata` —Å–æ–¥–µ—Ä–∂–∏—Ç GPS –¥–∞–Ω–Ω—ã–µ
   - `image_geolocation_point_id IS NULL`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞–≤–∏—Ç `GeolocationProcessJob` –≤ –æ—á–µ—Ä–µ–¥—å

### –í–∞–∂–Ω–æ

Nominatim API –∏–º–µ–µ—Ç rate limit 1 req/sec. –í Supervisor –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `numprocs=1`.

---

## images:faces

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü –¥–ª—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

```bash
php artisan images:faces
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ù–∞—Ö–æ–¥–∏—Ç `Image` –≥–¥–µ `faces_checked = 0`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞–≤–∏—Ç `FaceProcessJob` –≤ –æ—á–µ—Ä–µ–¥—å

---

## images:faces:check

–ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

```bash
php artisan images:faces:check
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ù–∞—Ö–æ–¥–∏—Ç `Image` –≥–¥–µ `faces_checked = 1` –ò–õ–ò `status = 'recheck'`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ debug-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
3. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∞:
   - –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ—Ç parent_id —É –¥–æ—á–µ—Ä–Ω–∏—Ö –ª–∏—Ü
   - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ª–∏—Ü–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –£–¥–∞–ª—è–µ—Ç debug-—Ñ–∞–π–ª
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏
   - –°—Ç–∞–≤–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–Ω–æ–≤–æ

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è threshold –≤ Face API
- –ï—Å–ª–∏ debug-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—ã–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã
- –î–ª—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∏ (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `status = 'recheck'`)

---

## images:phashes

–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç perceptual hash –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

```bash
php artisan images:phashes
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. –í—ã—á–∏—Å–ª—è–µ—Ç pHash –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ MD5 –∏ pHash
4. –û–±–Ω–æ–≤–ª—è–µ—Ç `phash` –∏ `parent_id` –≤ –ë–î

### –í–∞–∂–Ω–æ

- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** (–Ω–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
- –ú–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –±–æ–ª—å—à–æ–π –±–∞–∑—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–∞

---

## images:check

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤.

```bash
php artisan images:check
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç

–î–ª—è –∫–∞–∂–¥–æ–≥–æ `Image` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ:
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- Debug-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ `debug_filename` –∑–∞–¥–∞–Ω)
- Thumbnail (–µ—Å–ª–∏ `thumbnail_filename` –∑–∞–¥–∞–Ω)

### –í—ã–≤–æ–¥

```
Image (ID: 123) not exists: /path/to/missing.jpg
Debug image (ID: 456) not exists: /path/to/debug/missing_debug.jpg
Thumbnail image (ID: 789) not exists: /path/to/300x200/missing_cover_300x200.jpg
```

---

## images:cleanup-unused

–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö debug-—Ñ–∞–π–ª–æ–≤.

```bash
php artisan images:cleanup-unused [--dry-run]
```

### –û–ø—Ü–∏–∏

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `--dry-run` | –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª—ã, –Ω–æ –Ω–µ —É–¥–∞–ª—è—Ç—å |

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ `debug_filename` –∏–∑ –ë–î
2. –°–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `debug/`
3. –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –Ω–∏ –∫ –æ–¥–Ω–æ–º—É `Image`

### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
php artisan images:cleanup-unused --dry-run

# –£–¥–∞–ª–∏—Ç—å
php artisan images:cleanup-unused
```

### –í—ã–≤–æ–¥ (dry-run)

```
üß™ Dry-run —Ä–µ–∂–∏–º: —Ñ–∞–π–ª—ã –ù–ï –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.
üîç –°–∫–∞–Ω–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É images...
üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–∞: private
üü° –ë—ã–ª –±—ã —É–¥–∞–ª—ë–Ω: images/debug/orphan1_debug.jpg
üü° –ë—ã–ª –±—ã —É–¥–∞–ª—ë–Ω: images/debug/orphan2_debug.jpg
üß™ Dry-run –∑–∞–≤–µ—Ä—à—ë–Ω. –õ–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤: 2
```

---

## –û–±—â–∏–µ —Å–æ–≤–µ—Ç—ã

### Dry-run —á–µ—Ä–µ–∑ ENV

–õ—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –≤ —Ä–µ–∂–∏–º–µ dry-run:

```bash
IMAGE_PROCESSING_DRY_RUN=true php artisan images:process private images
```

### Debug —á–µ—Ä–µ–∑ ENV

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```bash
IMAGE_PROCESSING_DEBUG=true php artisan images:thumbnails
```

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è

```bash
IMAGE_PROCESSING_DRY_RUN=true IMAGE_PROCESSING_DEBUG=true php artisan images:faces
```
